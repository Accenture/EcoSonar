# Plugin SonarQube EcoSonar

## Introduction 
This plugin aims to verify for the project analyzed by Sonar that good eco-design practices have been implemented (see book of 115 good practices in web eco-design).
An additional page is added to the project allowing to retrieve the different important functionalities of a web application, it is also possible to monitor them. Developers using this plugin thus set up good practices and follow them.

## Getting Started

###Prerequisites
- Java 11
- Maven 3.8.3
- SonarQube 9.1.x (or below above 8.0 required) Community Edition : https://www.sonarqube.org/downloads/

### Build and run

To build the plugin JAR file:

```
mvn clean package
```

Then copy the file located at the following path `target/ecosonar-1.0-SNAPSHOT.jar`.
Go to the downloaded Sonarqube folder  `extensions/plugins/` and paste the JAR.

To finally launch Sonarqube with the plugin, run the shell script: `bin/windows-x86-64/StartSonar.bat`.

The Sonarqube instance startup logs are located in the file `logs/web.log` 

#### Switch environment

To build the Sonar application locally, please use the local URL by uncommenting the baseUrl in the files:
`src/main/java/com/ls/api/GreenITAnalysis.java` and `src/main/js/config/axiosConfiguration.js`
and replacing the url used by the local URL base.

Be careful to put back the Azure URL base when merging the branch!

## Launch a Sonarqube analysis from Azure Pipelines on a local SonarQube server

1. Download ngrok https://ngrok.com/ 

2. Launch the Sonarqube server on http://localhost:9000/

3. On a command prompt, launch:
```
ngrok http 9000
```

4. Retrieve the http url provided by ngrok

5. Create an authentication token on sonarqube :  (go to My Account > Security > Generate Tokens)

6. In Project Settings on Azure DevOps > Service Connections, add a connection service of type SonarQube; server url the url given by ngrok; the token generated by Sonar

7. Choose a connection service name and add it to the pipeline script as the SonarQube Server Endpoint.

8. Launch the correctly configured pipeline with the project key defined on the SonarQube server

9. The analysis is launched and you should see the results on the corresponding project page.

## Launch a Sonarqube analysis from Azure Pipelines on a deployed SonarQube server

1. In Azure DevOps, go to project settings, then Service Connections

2. Add a new service connection with the following parameters :
- connection type : Sonarqube
- server URL : url of the sonarqube instance
- token : token generated when creating the Sonarqube project
- service connecton name

3. In the Azure Pipelines file, set up Sonarqube analysis using Sonarque service connection previously registered and project key defined in the Sonarqube instance.